<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUST - Map Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f3f4f6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #maptest {
            height: 400px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            margin: 20px 0;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
        }
        .success {
            background: #dcfce7;
            border-color: #16a34a;
            color: #166534;
        }
        .error {
            background: #fef2f2;
            border-color: #dc2626;
            color: #991b1b;
        }
        .btn {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🗺️ JUST Map Diagnostic Test</h1>
        <p>This page tests basic Leaflet map functionality outside of React.</p>

        <div id="status" class="status">
            <strong>Status:</strong> <span id="statusText">Initializing...</span>
        </div>

        <div id="maptest"></div>

        <div id="details">
            <h3>📋 Test Details:</h3>
            <ul id="testList">
                <li>Loading Leaflet CSS... <span id="cssStatus">⏳</span></li>
                <li>Loading Leaflet JS... <span id="jsStatus">⏳</span></li>
                <li>Creating map instance... <span id="mapStatus">⏳</span></li>
                <li>Adding tile layer... <span id="tileStatus">⏳</span></li>
                <li>Adding markers... <span id="markerStatus">⏳</span></li>
            </ul>
        </div>

        <div style="margin-top: 20px;">
            <button onclick="createMap()" class="btn">🔄 Retry Map Creation</button>
            <a href="/map" class="btn">🔗 Try React Map</a>
            <a href="/test-components.html" class="btn">🔧 Component Test</a>
            <a href="/dashboard" class="btn">📊 Dashboard</a>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #f9fafb; border-radius: 6px;">
            <h4>🔍 Debug Information:</h4>
            <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
            <p><strong>Screen Size:</strong> <span id="screenSize"></span></p>
            <p><strong>Leaflet Version:</strong> <span id="leafletVersion">Not loaded</span></p>
            <p><strong>Console Errors:</strong> <span id="errorCount">0</span></p>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let errorCount = 0;
        
        // Capture errors
        window.addEventListener('error', function(e) {
            errorCount++;
            document.getElementById('errorCount').textContent = errorCount;
            console.error('Error captured:', e.message);
            updateStatus('❌ Error: ' + e.message, 'error');
        });

        function updateStatus(message, type = 'status') {
            const statusEl = document.getElementById('status');
            const statusText = document.getElementById('statusText');
            statusText.textContent = message;
            statusEl.className = 'status ' + type;
            console.log('Status:', message);
        }

        function updateTest(testId, status) {
            const element = document.getElementById(testId);
            if (element) {
                element.textContent = status;
            }
        }

        function createMap() {
            try {
                updateStatus('Starting map creation...', 'status');
                
                // Clear existing map
                const mapContainer = document.getElementById('maptest');
                mapContainer.innerHTML = '';
                
                // Check Leaflet
                updateTest('cssStatus', '✅');
                if (typeof L === 'undefined') {
                    throw new Error('Leaflet not loaded');
                }
                updateTest('jsStatus', '✅');
                
                // Update debug info
                document.getElementById('leafletVersion').textContent = L.version || 'Unknown';
                document.getElementById('userAgent').textContent = navigator.userAgent;
                document.getElementById('screenSize').textContent = screen.width + 'x' + screen.height;

                updateStatus('Creating map instance...', 'status');
                
                // Create map
                const map = L.map('maptest').setView([6.5244, 3.3792], 11);
                updateTest('mapStatus', '✅');
                
                updateStatus('Adding tile layer...', 'status');
                
                // Add tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors',
                    maxZoom: 18
                }).addTo(map);
                updateTest('tileStatus', '✅');
                
                updateStatus('Adding markers...', 'status');
                
                // Add markers
                const marker1 = L.marker([6.5244, 3.3792]).addTo(map);
                marker1.bindPopup('🏠 Lagos, Nigeria<br>Main test marker');
                
                const marker2 = L.marker([6.4531, 3.3958]).addTo(map);
                marker2.bindPopup('🏢 Victoria Island<br>Business district');
                
                const marker3 = L.marker([6.5795, 3.3211]).addTo(map);
                marker3.bindPopup('✈️ Ikeja<br>Airport area');
                
                updateTest('markerStatus', '✅');
                
                updateStatus('✅ Map created successfully!', 'success');
                
                // Auto-open first popup after a short delay
                setTimeout(() => {
                    marker1.openPopup();
                }, 1000);
                
            } catch (error) {
                console.error('Map creation error:', error);
                updateStatus('❌ Failed to create map: ' + error.message, 'error');
                updateTest('mapStatus', '❌');
            }
        }

        // Auto-create map when page loads
        window.addEventListener('load', function() {
            setTimeout(createMap, 500);
        });
    </script>
</body>
</html>
